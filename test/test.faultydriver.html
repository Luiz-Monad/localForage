<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>localForage Tests!</title>

        <link rel="stylesheet" href="/bower_components/mocha/mocha.css" />
    </head>
    <body>
        <div id="mocha"></div>

        <script>
            try {
                window.originalIdbOpen = window.indexedDB.open;
                window.indexedDB.open = function faultyIdbOpen() {
                    var openreq = {};
                    setTimeout(function () {
                        if (typeof openreq.onerror === 'function') {
                            openreq.onerror(
                                new Event(new Error('OpenDatabase Faulty Driver Test!'))
                            );
                        }
                    });
                    return openreq;
                };
            } catch (error) {}

            try {
                window.originalOpenDatabase = window.openDatabase;
                window.openDatabase = function faultyOpenDatabase() {
                    throw new Error('OpenDatabase Faulty Driver Test!');
                };
            } catch (error) {}

            try {
                window.originalLocalStorageSetItem = window.localStorage.setItem;
                window.localStorage.setItem = function faultySetItemQuotaError() {
                    throw new DOMException('The quota has been exceeded.', 'QuotaExceededError');
                };
            } catch (error) {}
        </script>

        <!-- localForage -->
        <script src="/dist/localforage.js"></script>

        <!-- Modernizr  -->
        <script src="/bower_components/modernizr/modernizr.js"></script>

        <!-- test libs -->
        <script src="/bower_components/requirejs/require.js"></script>
        <script src="/bower_components/assert/assert.js"></script>
        <script src="/bower_components/mocha/mocha.js"></script>
        <script src="/bower_components/chai/chai.js"></script>

        <!-- Test runner -->
        <script>
            require(['mocha'], () => mocha.setup('bdd'));
        </script>

        <!-- specs -->
        <script src="/test/test.faultydriver.js"></script>

        <!-- Disable warning -->
        <script>
            window.console.warn = function () {};
        </script>

        <!-- Run tests -->
        <script>
            require(['mocha', 'test.faultydriver'], () => mocha.run());
        </script>
    </body>
</html>
